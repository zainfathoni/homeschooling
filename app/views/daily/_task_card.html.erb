<%# locals: (subject:, date:, completed:, has_document:) %>
<%= turbo_frame_tag dom_id(subject, "task_#{date}") do %>
  <div class="relative w-full bg-lavender/40 rounded-lg overflow-hidden flex items-center gap-4 p-4 pl-5">
    <%# Left accent tab - positioned absolutely to avoid wavy border effect %>
    <div class="absolute left-0 top-0 bottom-0 w-1.5 <%= completed ? 'bg-coral' : 'bg-gray-300' %>"></div>

    <%= button_to toggle_completion_path(subject_id: subject.id, date: date),
        method: :post,
        class: "w-11 h-11 rounded-lg border-2 flex items-center justify-center shrink-0 cursor-pointer
               focus:outline-none focus:ring-2 focus:ring-coral focus:ring-offset-2 transition-all
               #{completed ? 'bg-coral border-coral' : 'border-gray-300 hover:border-coral'}",
        data: { turbo_frame: dom_id(subject, "task_#{date}") },
        aria: { label: "#{completed ? 'Mark incomplete' : 'Mark complete'}: #{subject.name}" } do %>
      <% if completed %>
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
        </svg>
      <% end %>
    <% end %>

    <div class="flex-1 min-w-0 flex items-center justify-between gap-2">
      <span class="text-base font-medium text-gray-800 <%= 'line-through text-gray-400' if completed %>">
        <%= subject.name %>
      </span>
      <% if subject.narration_required? %>
        <% if has_document %>
          <%= link_to student_documents_path(subject.student_for_document(current_student), date: date, subject_id: subject.id),
              class: "text-xs text-green-600 hover:text-green-700 inline-flex items-center gap-1 shrink-0",
              data: { turbo_frame: "_top" } do %>
            <span>âœ“</span> documented
          <% end %>
        <% else %>
          <%= link_to new_student_document_path(subject.student_for_document(current_student), subject_id: subject.id, date: date),
              class: "text-xs bg-coral/90 text-white px-2 py-0.5 rounded-full hover:bg-coral shrink-0",
              data: { turbo_frame: "_top" } do %>
            Document Required
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
