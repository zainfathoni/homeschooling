<%# locals: (subject:, date:, completed:, has_narration:) %>
<%= turbo_frame_tag dom_id(subject, "task_#{date}") do %>
  <div class="w-full bg-white rounded-xl p-4 shadow-sm border-l-4 flex items-center gap-4
              <%= completed ? 'border-coral' : 'border-gray-200' %>">
    <%= button_to toggle_completion_path(subject_id: subject.id, date: date),
        method: :post,
        class: "w-11 h-11 rounded-lg border-2 flex items-center justify-center shrink-0 cursor-pointer
               focus:outline-none focus:ring-2 focus:ring-coral focus:ring-offset-2 transition-all
               #{completed ? 'bg-coral border-coral' : 'border-gray-300 hover:border-coral'}",
        data: { turbo_frame: dom_id(subject, "task_#{date}") },
        aria: { label: "#{completed ? 'Mark incomplete' : 'Mark complete'}: #{subject.name}" } do %>
      <% if completed %>
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
        </svg>
      <% end %>
    <% end %>

    <div class="flex-1 min-w-0">
      <span class="text-lg font-medium text-gray-800 block <%= 'line-through text-gray-400' if completed %>">
        <%= subject.name %>
      </span>
      <% if subject.narration_required? %>
        <% if has_narration %>
          <%= link_to student_narrations_path(subject.student, date: date, subject_id: subject.id),
              class: "text-xs text-green-600 hover:text-green-700 inline-flex items-center gap-1",
              data: { turbo_frame: "_top" } do %>
            <span>âœ“</span> narrated
          <% end %>
        <% else %>
          <%= link_to new_student_narration_path(subject.student, subject_id: subject.id, date: date),
              class: "text-xs text-coral hover:text-coral/80 inline-flex items-center gap-1",
              data: { turbo_frame: "_top" } do %>
            <span>+</span> add narration
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
