<%# locals: (student:, date:, subjects:, completions:, pick1_selections:, off_day_subjects:) %>
<% completed_count = completions.size %>
<% total_count = subjects.size %>

<div class="bg-white rounded-xl p-4 shadow-sm">
  <header class="text-center mb-4">
    <p class="text-gray-600"><%= date.strftime("%A, %b %d") %></p>
    <%= render "daily/progress_ring", completed: completed_count, total: total_count %>
  </header>

  <div class="space-y-3">
    <% subjects.each do |subject| %>
      <% if subject.pick1? %>
        <%= render "daily/pick1_selector",
            subject: subject,
            date: date,
            selected_option_id: pick1_selections[subject.id],
            has_narration: subject.has_narration_for?(date) %>
      <% else %>
        <%= render "daily/task_card",
            subject: subject,
            date: date,
            completed: completions.include?(subject.id),
            has_narration: subject.has_narration_for?(date) %>
      <% end %>
    <% end %>
  </div>

  <% if off_day_subjects.any? %>
    <div class="mt-6 space-y-3">
      <h3 class="text-sm text-gray-500 font-medium">Not scheduled today</h3>
      <% off_day_subjects.each do |subject| %>
        <%= render "daily/off_day_card", subject: subject %>
      <% end %>
    </div>
  <% end %>
</div>
